FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGRhdGEtc3luYy1hcGIKZGVzY3JpcHRpb246IEluc3RhbGxzIHRo\
ZSBBZXJvZ2VhciBEYXRhIFN5bmMgU2VydmljZQpiaW5kYWJsZTogVHJ1ZQphc3luYzogb3B0aW9u\
YWwKdGFnczoKICAtIG1vYmlsZS1zZXJ2aWNlCiAgLSBtb2JpbGUtY2xpZW50LWVuYWJsZWQKbWV0\
YWRhdGE6CiAgZGlzcGxheU5hbWU6IERhdGEgU3luYwogIGNvbnNvbGUub3BlbnNoaWZ0LmlvL2lj\
b25DbGFzczogZmEgZmEtcmVmcmVzaAogICMgZG9jdW1lbnRhdGlvblVybDogImh0dHBzOi8vZG9j\
cy5hZXJvZ2Vhci5vcmcvZXh0ZXJuYWwvYXBiL21ldHJpY3MuaHRtbCIKICBwcm92aWRlckRpc3Bs\
YXlOYW1lOiAiUmVkIEhhdCwgSW5jLiIKICAjIHNkay1kb2NzLWFuZHJvaWQ6ICJodHRwczovL2Rv\
Y3MuYWVyb2dlYXIub3JnL2V4dGVybmFsL2FwYi9tZXRyaWNzL2FuZHJvaWQuaHRtbCIKICAjIHNk\
ay1kb2NzLWNvcmRvdmE6ICJodHRwczovL2RvY3MuYWVyb2dlYXIub3JnL2V4dGVybmFsL2FwYi9t\
ZXRyaWNzL2NvcmRvdmEuaHRtbCIKICAjIHNkay1kb2NzLWlvczogImh0dHBzOi8vZG9jcy5hZXJv\
Z2Vhci5vcmcvZXh0ZXJuYWwvYXBiL21ldHJpY3MvaW9zLmh0bWwiCiAgIyBzZGstZG9jcy14YW1h\
cmluOiAiaHR0cHM6Ly9kb2NzLmFlcm9nZWFyLm9yZy9leHRlcm5hbC9hcGIvbWV0cmljcy94YW1h\
cmluLmh0bWwiCiAgc2VydmljZU5hbWU6IGRhdGEtc3luYwogIGRlcGVuZGVuY2llczoKICAgIC0g\
ImRvY2tlci5pby9hZXJvZ2Vhci9kYXRhLXN5bmMtdWkiCiAgICAtICJkb2NrZXIuaW8vYWVyb2dl\
YXIvZGF0YS1zeW5jLXNlcnZlciIKICAgIC0gImRvY2tlci5pby9vcGVuc2hpZnQvb2F1dGgtcHJv\
eHk6djEuMS4wIgogICAgLSAiZG9ja2VyLmlvL2NlbnRvcy9wb3N0Z3Jlc3FsLTk2LWNlbnRvczc6\
OS42IgpwbGFuczoKICAtIG5hbWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBUaGlzIHBsYW4g\
c2V0cyB1cCB0aGUgRGF0YSBTeW5jIEFkbWluIFVJLCBUaGUgRGF0YSBTeW5jIFNlcnZlciBhbmQg\
UG9zdGdyZVNRTAogICAgZnJlZTogVHJ1ZQogICAgbWV0YWRhdGE6CiAgICAgIG1vYmlsZWNsaWVu\
dF9iaW5kX3BhcmFtZXRlcnNfZGF0YToKICAgICAgICAtICd7Im5hbWUiOiAiQ0xJRU5UX0lEIiwg\
InZhbHVlIjogIm1ldGFkYXRhLm5hbWUiLCAidHlwZSI6ICJwYXRoIn0nCiAgICBwYXJhbWV0ZXJz\
OiAKICAgICAgLSBuYW1lOiBQT1NUR1JFU19TVE9SQUdFX1NJWkUKICAgICAgICByZXF1aXJlZDog\
VHJ1ZQogICAgICAgIGRlZmF1bHQ6IDEwCiAgICAgICAgdHlwZTogbnVtYmVyCiAgICAgICAgdGl0\
bGU6IFBvc3RncmVzIFN0b3JhZ2UgU2l6ZSAoR2IpCiAgICAgIC0gbmFtZTogUE9TVEdSRVNfVVNF\
UgogICAgICAgIGRlc2NyaXB0aW9uOiBVc2VybmFtZSB0aGF0IHdpbGwgYmUgdXNlZCB0byBjb25u\
ZWN0IHRvIHBvc3RncmVzICgndXNlcicgd2lsbCBiZSB1c2VkIGlmIGJsYW5rKQogICAgICAgIGRl\
ZmF1bHQ6IHVzZXIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogRmFsc2UK\
ICAgICAgICB0aXRsZTogUG9zdGdyZXMgVXNlcgogICAgICAtIG5hbWU6IFBPU1RHUkVTX1BBU1NX\
T1JECiAgICAgICAgZGVzY3JpcHRpb246IFBhc3N3b3JkIHRvIGNvbm5lY3QgdG8gUG9zdGdyZXMg\
KGdlbmVyYXRlZCBpZiBibGFuaykKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJl\
ZDogRmFsc2UKICAgICAgICB0aXRsZTogUG9zdGdyZXMgUGFzc3dvcmQKICAgIGJpbmRfcGFyYW1l\
dGVyczoKICAgICAgLSBuYW1lOiBDTElFTlRfSUQKICAgICAgICByZXF1aXJlZDogVHJ1ZQogICAg\
ICAgIHRpdGxlOiBNb2JpbGUgQ2xpZW50IElECiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAg\
Cg=="










COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
COPY vars /opt/ansible/vars
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -p /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
