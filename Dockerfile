FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGRhdGEtc3luYy1hcGIKZGVzY3JpcHRpb246IEluc3RhbGxzIHRo\
ZSBBZXJvZ2VhciBEYXRhIFN5bmMgU2VydmljZQpiaW5kYWJsZTogVHJ1ZQphc3luYzogb3B0aW9u\
YWwKdGFnczoKICAtIG1vYmlsZS1zZXJ2aWNlCiAgLSBtb2JpbGUtY2xpZW50LWVuYWJsZWQKbWV0\
YWRhdGE6CiAgZGlzcGxheU5hbWU6IERhdGEgU3luYyBEZXYKICBjb25zb2xlLm9wZW5zaGlmdC5p\
by9pY29uQ2xhc3M6IGZhIGZhLXJlZnJlc2gKICAjIGRvY3VtZW50YXRpb25Vcmw6ICJodHRwczov\
L2RvY3MuYWVyb2dlYXIub3JnL2V4dGVybmFsL2FwYi9tZXRyaWNzLmh0bWwiCiAgcHJvdmlkZXJE\
aXNwbGF5TmFtZTogIlJlZCBIYXQsIEluYy4iCiAgIyBzZGstZG9jcy1hbmRyb2lkOiAiaHR0cHM6\
Ly9kb2NzLmFlcm9nZWFyLm9yZy9leHRlcm5hbC9hcGIvbWV0cmljcy9hbmRyb2lkLmh0bWwiCiAg\
IyBzZGstZG9jcy1jb3Jkb3ZhOiAiaHR0cHM6Ly9kb2NzLmFlcm9nZWFyLm9yZy9leHRlcm5hbC9h\
cGIvbWV0cmljcy9jb3Jkb3ZhLmh0bWwiCiAgIyBzZGstZG9jcy1pb3M6ICJodHRwczovL2RvY3Mu\
YWVyb2dlYXIub3JnL2V4dGVybmFsL2FwYi9tZXRyaWNzL2lvcy5odG1sIgogICMgc2RrLWRvY3Mt\
eGFtYXJpbjogImh0dHBzOi8vZG9jcy5hZXJvZ2Vhci5vcmcvZXh0ZXJuYWwvYXBiL21ldHJpY3Mv\
eGFtYXJpbi5odG1sIgogIHNlcnZpY2VOYW1lOiBkYXRhLXN5bmMKICBkZXBlbmRlbmNpZXM6CiAg\
ICAtICJkb2NrZXIuaW8vYWVyb2dlYXIvZGF0YS1zeW5jLXVpIgogICAgLSAiZG9ja2VyLmlvL2Fl\
cm9nZWFyL2RhdGEtc3luYy1zZXJ2ZXIiCiAgICAtICJkb2NrZXIuaW8vb3BlbnNoaWZ0L29hdXRo\
LXByb3h5IgogICAgLSAiZG9ja2VyLmlvL2NlbnRvcy9wb3N0Z3Jlc3FsLTk2LWNlbnRvczc6OS42\
IgpwbGFuczoKICAtIG5hbWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBUaGlzIHBsYW4gc2V0\
cyB1cCB0aGUgRGF0YSBTeW5jIEFkbWluIFVJLCBUaGUgRGF0YSBTeW5jIFNlcnZlciBhbmQgUG9z\
dGdyZVNRTAogICAgZnJlZTogVHJ1ZQogICAgbWV0YWRhdGE6CiAgICAgIG1vYmlsZWNsaWVudF9i\
aW5kX3BhcmFtZXRlcnNfZGF0YToKICAgICAgICAtICd7Im5hbWUiOiAiQ0xJRU5UX0lEIiwgInZh\
bHVlIjogIm1ldGFkYXRhLm5hbWUiLCAidHlwZSI6ICJwYXRoIn0nCiAgICBwYXJhbWV0ZXJzOiAK\
ICAgICAgLSBuYW1lOiBQT1NUR1JFU19TVE9SQUdFX1NJWkUKICAgICAgICByZXF1aXJlZDogVHJ1\
ZQogICAgICAgIGRlZmF1bHQ6IDEwCiAgICAgICAgdHlwZTogbnVtYmVyCiAgICAgICAgdGl0bGU6\
IFBvc3RncmVzIFN0b3JhZ2UgU2l6ZSAoR2IpCiAgICAgIC0gbmFtZTogUE9TVEdSRVNfVVNFUgog\
ICAgICAgIGRlc2NyaXB0aW9uOiBVc2VybmFtZSB0aGF0IHdpbGwgYmUgdXNlZCB0byBjb25uZWN0\
IHRvIHBvc3RncmVzICgndXNlcicgd2lsbCBiZSB1c2VkIGlmIGJsYW5rKQogICAgICAgIGRlZmF1\
bHQ6IHVzZXIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogRmFsc2UKICAg\
ICAgICB0aXRsZTogUG9zdGdyZXMgVXNlcgogICAgICAtIG5hbWU6IFBPU1RHUkVTX1BBU1NXT1JE\
CiAgICAgICAgZGVzY3JpcHRpb246IFBhc3N3b3JkIHRvIGNvbm5lY3QgdG8gUG9zdGdyZXMgKGdl\
bmVyYXRlZCBpZiBibGFuaykKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDog\
RmFsc2UKICAgICAgICB0aXRsZTogUG9zdGdyZXMgUGFzc3dvcmQKICAgIGJpbmRfcGFyYW1ldGVy\
czoKICAgICAgLSBuYW1lOiBDTElFTlRfSUQKICAgICAgICByZXF1aXJlZDogVHJ1ZQogICAgICAg\
IHRpdGxlOiBNb2JpbGUgQ2xpZW50IElECiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgCg=="










COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
COPY vars /opt/ansible/vars
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -p /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
